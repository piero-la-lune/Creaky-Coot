function isset(e){return e!==void 0&&null!==e}function Ajax(e,n){this.post=[],this.elm=void 0,this.loader=void 0,e&&(this.elm=e,this.loader=document.createElement("span"),this.loader.className="loading",this.loader.innerHTML='<i class="n1"></i><i class="n2"></i><i class="n3"></i>',this.elm.parentNode.replaceChild(this.loader,this.elm)),this.post.push("action="+n),this.post.push("page="+page),this.addParam=function(e,n){this.post.push(e+"="+encodeURIComponent(n))},this.send=function(e,n){var t=this,i=new XMLHttpRequest;i.open("POST",ajax_url),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(this.post.join("&")),i.onreadystatechange=function(){if(i.readyState==i.DONE){if(200==i.status){var o=JSON.parse(i.responseText);"success"==o.status?e!==void 0&&e(o):n!==void 0&&n(o)}else 403==i.status?alert(m_error_login):alert(m_error_ajax);t.cancel()}}},this.cancel=function(){this.loader&&this.loader.parentNode.replaceChild(this.elm,this.loader)}}function onclick_logout(){document.getElementById("form-logout").submit()}function onclick_load(e,n){var t=new Ajax(e,"load"),i=document.querySelectorAll(".div-link");i.length>0&&t.addParam("id",i[i.length-1].id.split("-")[1]),"undefined"!=typeof feed&&t.addParam("feed",feed),"undefined"!=typeof tag&&t.addParam("tag",tag),"undefined"!=typeof q&&t.addParam("q",q),n.type!==void 0&&t.addParam("type",n.type),t.send(function(e){var n=document.createElement("div");n.innerHTML=e.html;var t=document.querySelector(".p-more");t.parentNode.insertBefore(n,t)},function(){t.elm=document.createElement("span"),t.elm.innerHTML=m_no_more_link})}function onclick_refresh(e){var n=new Ajax(e,"refresh");return"undefined"!=typeof tag?(n.cancel(),!1):"undefined"!=typeof q?(n.cancel(),!1):("undefined"!=typeof feed&&n.addParam("feed",feed),n.send(function(e){var n=document.createElement("div");n.innerHTML=e.html;var t=document.querySelector(".div-link");t||(t=document.querySelector(".p-more")),t.parentNode.insertBefore(n,t)}),void 0)}function onclick_allRead(e){for(var n=new Ajax(e,"read"),t=[],i=document.querySelectorAll(".div-link"),o=0;i.length>o;o++)t.push(i[o].id.split("-")[1]);n.addParam("ids",t.join(",")),n.send(function(e){for(var n in e.ids){var t=document.getElementById("link-"+n);if("links"==page)t.querySelector("h2").className="",t.querySelector(".a-read").style.display="none",t.querySelector(".a-unread").style.display="inline-block";else{var i=t.parentNode;i.removeChild(t)}}})}function onclick_allClear(e){if(!confirm(m_confirm_clear))return!1;for(var n=new Ajax(e,"clear"),t=[],i=document.querySelectorAll(".div-link"),o=0;i.length>o;o++)t.push(i[o].id.split("-")[1]);n.addParam("ids",t.join(",")),n.send(function(e){for(var n in e.ids){var t=document.getElementById("link-"+n);t.parentNode.removeChild(t)}})}function onclick_read(e,n){var t=new Ajax(e,"read");t.addParam("ids",n.id),t.send(function(t){if(t.ids[n.id]===void 0)return!1;var i=document.getElementById("link-"+n.id);"home"==page?i.parentNode.removeChild(i):("links"==page&&(i.querySelector("h2").className=""),e.style.display="none",i.querySelector(".a-unread").style.display="inline-block")})}function onclick_unread(e,n){var t=new Ajax(e,"unread");t.addParam("ids",n.id),t.send(function(t){if(t.ids[n.id]===void 0)return!1;var i=document.getElementById("link-"+n.id);"links"==page&&(i.querySelector("h2").className="unread"),e.style.display="none",i.querySelector(".a-read").style.display="inline-block"})}function onclick_archive(e,n){var t=new Ajax(e,"archive");t.addParam("ids",n.id),t.send(function(t){if(t.ids[n.id]===void 0)return!1;var i=document.getElementById("link-"+n.id);"home"==page?i.parentNode.removeChild(i):("links"==page&&(i.querySelector("h2").className=""),i.querySelector(".a-read").style.display="none",i.querySelector(".a-unread").style.display="none",e.style.display="none")})}function onclick_delete(e,n){if(!confirm(m_confirm_delete))return!1;var t=new Ajax(e,"delete");t.addParam("ids",n.id),t.send(function(e){if(e.ids[n.id]===void 0)return!1;if("link"==page)window.location.href=home_url;else{var t=document.getElementById("link-"+n.id);t.parentNode.removeChild(t)}})}function onclick_edit(e,n){var t={title:document.querySelector("h1"),content:document.querySelector(".div-content"),tags:document.querySelector(".tags"),comment:document.querySelector(".div-comment"),url:document.querySelector(".p-url"),actions:document.querySelectorAll(".div-actions")},i={tags:document.getElementById("tags"),editTags:document.querySelector(".editTags"),editor:document.querySelector(".div-edit")},o=t.title.innerHTML,a=t.content.innerHTML,d=t.comment.innerHTML,l=i.tags.value,r=t.actions[1].querySelectorAll("a")[0],c=t.actions[1].querySelectorAll("a")[1];t.title.setAttribute("contenteditable",!0),t.content.setAttribute("contenteditable",!0),t.comment.setAttribute("contenteditable",!0),t.tags.style.display="none",t.url.style.display="none",i.editTags.style.display="inline",i.editTags.querySelector("span").innerHTML="",i.tags.onupdate(),i.editor.style.display="block",t.actions[0].style.display="none",t.actions[1].style.display="block",r.onclick=function(){var e=new Ajax(r,"edit");e.addParam("id",n.id),e.addParam("title",t.title.innerHTML),e.addParam("content",t.content.innerHTML),e.addParam("tags",i.tags.value),e.addParam("comment",t.comment.innerHTML),e.send(function(e){o=e.title,a=e.content,d=e.comment,l=e.tags.join(", "),c.click(),t.tags.innerHTML=e.tags_list})},c.onclick=function(){t.title.setAttribute("contenteditable",!1),t.content.setAttribute("contenteditable",!1),t.comment.setAttribute("contenteditable",!1),t.title.innerHTML=o,t.content.innerHTML=a,t.comment.innerHTML=d,t.tags.style.display="inline",t.url.style.display="block",i.editTags.style.display="none",i.tags.value=l,i.editor.style.display="none",t.actions[0].style.display="block",t.actions[1].style.display="none"}}function onload_tags(){function e(){for(var e=a.querySelectorAll(".tag"),n=[],t=0;e.length>t;t++)n.push(e[t].innerHTML);l.value=n.join(",")}function n(e){var n=document.createElement("a");n.href="#",n.className="tag",n.innerHTML=e,n.onclick=i,d.appendChild(n)}function t(){""!==r.value&&(n(r.value),r.value="",e())}function i(n){return n.srcElement.parentNode.removeChild(n.srcElement),e(),!1}function o(){if(""!==l.value)for(var e=l.value.split(/,/),t=0;e.length>t;t++)n(e[t])}var a=document.querySelector(".editTags"),d=a.querySelector("span"),l=document.getElementById("tags"),r=document.getElementById("addTag"),c=document.querySelector(".pick-tag"),s=c.querySelectorAll("span"),u=!1;c.onmousedown=function(e){"visible"==e.srcElement.className&&(r.value=e.srcElement.innerHTML,t(),u=!0)},r.onkeydown=function(e){if("keyCode"in e&&(13==e.keyCode||188==e.keyCode)||"key"in e&&("Enter"==e.key||","==e.key))return t(),r.blur(),r.focus(),!1;if("keyCode"in e&&9==e.keyCode||"key"in e&&"Tab"==e.key){var n=form.list.querySelector(".visible");return null!==n&&(r.value=n.innerHTML,t(),r.blur(),r.focus()),!1}},r.onfocus=function(){var e=r.getBoundingClientRect();c.style.left=e.left+"px",c.style.top=e.bottom+"px",r.onkeyup()},r.onblur=function(){u?(u=!1,r.focus()):(c.style.left="-9999px",c.style.top="-9999px")},r.onkeyup=function(){for(var e=r.value,n=0;s.length>n;n++)s[n].className=-1===s[n].innerHTML.indexOf(e)?"":"visible"},l.onupdate=o,o()}function onclick_clear_feed(e,n){if(!confirm(m_confirm_clear_f))return!1;var t=new Ajax(e,"clear_feed");t.addParam("feed",n.id),t.send()}function onclick_delete_feed(e,n){if(!confirm(m_confirm_delete_f))return!1;var t=new Ajax(e,"delete_feed");t.addParam("feed",n.id),t.send(function(){var e=document.getElementById("feed-"+n.id);e.parentNode.removeChild(e)})}function onclick_js_add(){alert(m_add_popup),document.getElementById("js_add").style.display="block"}function onclick_formate(e,n){if("link"==n.cmd){var t=prompt(m_enter_url,"http://");if(t&&"http://"!=t)return document.execCommand("createlink",!1,t)}if("image"!=n.cmd)return n.value!==void 0?document.execCommand(n.cmd,!1,n.value):document.execCommand(n.cmd,!1,null);var i=prompt(m_enter_url,"http://");return i&&"http://"!=i?document.execCommand("insertImage",!1,i):!1}null!==document.querySelector(".editTags")&&onload_tags();